<html>
<head>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
function parseData() {
  const txt = document.getElementById('myData').value;
  const lines = txt.split(/[\r\n]/);
  if (lines.length == 0) {
    return null;
  }
  const init = lines[0].replace(/^# */, "").trim();
  const keys = init.split(/[,\s]+/);
  var data = [];
  for (var i = 1; i < lines.length; ++i) {
    const line = lines[i].replace(/^# */, "").trim();
    if (line.length > 0) {
      const cols = line.split(/[,\s]+/);
      var obj = {'row#':i.toString()};
      data.push(obj);
      for (var j = 0; j< cols.length; ++j) {
        obj[keys[j]] = cols[j];
      }
    }
  }
  return data;
}
function loadKeys() {
  const txt = document.getElementById('myData').value;
  const lines = txt.split(/[\r\n]/);
  if (lines.length == 0) {
    return null;
  }
  const init = lines[0].replace(/^# */, '').trim();
  const keys = init.split(/[,\s]+/);
  const xkeySel = document.getElementById('xkey');
  const ykeySel = document.getElementById('ykey');
  xkeySel.innerHTML = '<option>row#</option>';
  for (const k of keys) {
    if (k.trim().length > 0) {
      xkeySel.innerHTML += '<option>' + k.trim() + '</option>';
      ykeySel.innerHTML += '<option>' + k.trim() + '</option>';
    }
  }
}

var chart = null;

function render() {
  const ctx = document.getElementById('myChart');
  const type = document.getElementById('chart-type').value;
  const data = parseData();
  const xkey = document.getElementById('xkey').value;
  const ykey = document.getElementById('ykey').value;
  const cfg = {
    type: type,
    data: {
      datasets: [{data: data}]
    },
    options: {
      parsing: {
        xAxisKey: xkey,
        yAxisKey: ykey
      }
    }
  };
  if (chart) {
    chart.clear();
    chart.destroy();
  }
  chart = new Chart(ctx, cfg);
}
</script>
</head>
<body>
<label>csv/tsv content:</label><br/>
<textarea id="myData" cols="80" rows="20" onchange="loadKeys()">
</textarea><br/>
<label>chart type: </label>
<select id="chart-type">
    <option>line</option>
    <option>bar</option>
    <option>scatter</option>
</select>
<label>X: </label><select id="xkey">
</select>
<label>Y: </label><select id="ykey">
</select>
<button onclick="render()">render</button>
<div>
    <canvas id="myChart"></canvas>
</div>
</body>
</html>
