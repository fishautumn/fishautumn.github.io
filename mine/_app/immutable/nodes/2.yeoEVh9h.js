import{s as L,e as N,d as P,f as V,i as j,O as nt,v as I,k as q,l as B,P as J,Q as gt,n as Q,A as ut,R as _t,t as lt,b as A,h as ot,j as F,S as X,m as xt,T as at,U as pt,x as mt,V as yt}from"../chunks/scheduler.BjLM5BuZ.js";import{S as W,i as Y,t as D,g as ht,c as dt,a as G,f as bt,b as Z,d as $,m as tt,e as et}from"../chunks/index.Bvgwt8uf.js";function H(l){return(l==null?void 0:l.length)!==void 0?l:Array.from(l)}function wt(l,t){const n={},i={},c={$$scope:1};let f=l.length;for(;f--;){const s=l[f],e=t[f];if(e){for(const o in s)o in e||(i[o]=1);for(const o in e)c[o]||(n[o]=e[o],c[o]=1);l[f]=e}else for(const o in s)c[o]=1}for(const s in i)s in n||(n[s]=void 0);return n}function kt(l){return typeof l=="object"&&l!==null?l:{}}function vt(l){let t,n,i,c,f,s;return{c(){t=N("button"),n=N("img"),this.h()},l(e){t=P(e,"BUTTON",{id:!0,class:!0});var o=V(t);n=P(o,"IMG",{src:!0,alt:!0,class:!0}),o.forEach(j),this.h()},h(){nt(n.src,i=l[2])||I(n,"src",i),I(n,"alt",""),I(n,"class","svelte-4wjcsy"),I(t,"id",c=`c-${l[0]}-${l[1]}`),I(t,"class","svelte-4wjcsy")},m(e,o){q(e,t,o),B(t,n),f||(s=[J(t,"click",l[3]),J(t,"contextmenu",gt(l[8]))],f=!0)},p(e,[o]){o&4&&!nt(n.src,i=e[2])&&I(n,"src",i),o&3&&c!==(c=`c-${e[0]}-${e[1]}`)&&I(t,"id",c)},i:Q,o:Q,d(e){e&&j(t),f=!1,ut(s)}}}function Ct(l,t,n){let i,{value:c}=t,{x:f}=t,{y:s}=t,{status:e}=t,{is_init:o}=t,{freeze:m}=t;const y=_t(),M={init:"init",clear:c,mark:"flag",fail:"mine-red",wrong:"flag-red"};function z(d){m||(o?e=="init"?d.button==0?c==-1?(n(4,e="fail"),y("fail",{x:f,y:s})):(n(4,e="clear"),c==0&&y("confirm",{x:f,y:s})):d.button==2&&(y("flag",{x:f,y:s}),n(4,e="mark")):e=="clear"&&c>0?y("confirm",{x:f,y:s}):e=="mark"&&d.button==2&&(y("unflag",{x:f,y:s}),n(4,e="init")):(n(5,o=!0),y("init",{x:f,y:s})))}const _=()=>z({button:2});return l.$$set=d=>{"value"in d&&n(6,c=d.value),"x"in d&&n(0,f=d.x),"y"in d&&n(1,s=d.y),"status"in d&&n(4,e=d.status),"is_init"in d&&n(5,o=d.is_init),"freeze"in d&&n(7,m=d.freeze)},l.$$.update=()=>{l.$$.dirty&80&&n(2,i=(M[e]??c??"init")+".svg")},[f,s,i,z,e,o,c,m,_]}class Et extends W{constructor(t){super(),Y(this,t,Ct,vt,L,{value:6,x:0,y:1,status:4,is_init:5,freeze:7})}}function st(l,t,n){const i=l.slice();return i[25]=t[n],i}function it(l,t,n){const i=l.slice();return i[28]=t[n],i[29]=t,i[30]=n,i}function ft(l){let t,n,i;const c=[l[28]];function f(e){l[12](e,l[28])}let s={};for(let e=0;e<c.length;e+=1)s=pt(s,c[e]);return l[28].status!==void 0&&(s.status=l[28].status),t=new Et({props:s}),mt.push(()=>bt(t,"status",f)),t.$on("flag",l[3]),t.$on("unflag",l[4]),t.$on("confirm",l[5]),t.$on("init",l[6]),t.$on("fail",l[7]),{c(){Z(t.$$.fragment)},l(e){$(t.$$.fragment,e)},m(e,o){tt(t,e,o),i=!0},p(e,o){l=e;const m=o&2?wt(c,[kt(l[28])]):{};!n&&o&2&&(n=!0,m.status=l[28].status,yt(()=>n=!1)),t.$set(m)},i(e){i||(D(t.$$.fragment,e),i=!0)},o(e){G(t.$$.fragment,e),i=!1},d(e){et(t,e)}}}function ct(l){let t,n,i,c=H(l[25]),f=[];for(let e=0;e<c.length;e+=1)f[e]=ft(it(l,c,e));const s=e=>G(f[e],1,1,()=>{f[e]=null});return{c(){t=N("div");for(let e=0;e<f.length;e+=1)f[e].c();n=A(),this.h()},l(e){t=P(e,"DIV",{class:!0});var o=V(t);for(let m=0;m<f.length;m+=1)f[m].l(o);n=F(o),o.forEach(j),this.h()},h(){I(t,"class","row svelte-73hlw")},m(e,o){q(e,t,o);for(let m=0;m<f.length;m+=1)f[m]&&f[m].m(t,null);B(t,n),i=!0},p(e,o){if(o&250){c=H(e[25]);let m;for(m=0;m<c.length;m+=1){const y=it(e,c,m);f[m]?(f[m].p(y,o),D(f[m],1)):(f[m]=ft(y),f[m].c(),D(f[m],1),f[m].m(t,n))}for(ht(),m=c.length;m<f.length;m+=1)s(m);dt()}},i(e){if(!i){for(let o=0;o<c.length;o+=1)D(f[o]);i=!0}},o(e){f=f.filter(Boolean);for(let o=0;o<f.length;o+=1)G(f[o]);i=!1},d(e){e&&j(t),at(f,e)}}}function Tt(l){let t,n,i,c,f,s,e,o="restart",m,y,M,z,_,d=H(l[1]),r=[];for(let a=0;a<d.length;a+=1)r[a]=ct(st(l,d,a));const T=a=>G(r[a],1,1,()=>{r[a]=null});return{c(){t=N("p"),n=N("code"),i=lt("Remain: "),c=lt(l[2]),f=A(),s=N("p"),e=N("button"),e.textContent=o,m=A(),y=N("div");for(let a=0;a<r.length;a+=1)r[a].c()},l(a){t=P(a,"P",{});var p=V(t);n=P(p,"CODE",{});var b=V(n);i=ot(b,"Remain: "),c=ot(b,l[2]),b.forEach(j),p.forEach(j),f=F(a),s=P(a,"P",{});var w=V(s);e=P(w,"BUTTON",{"data-svelte-h":!0}),X(e)!=="svelte-5dldn0"&&(e.textContent=o),w.forEach(j),m=F(a),y=P(a,"DIV",{});var E=V(y);for(let S=0;S<r.length;S+=1)r[S].l(E);E.forEach(j)},m(a,p){q(a,t,p),B(t,n),B(n,i),B(n,c),q(a,f,p),q(a,s,p),B(s,e),q(a,m,p),q(a,y,p);for(let b=0;b<r.length;b+=1)r[b]&&r[b].m(y,null);M=!0,z||(_=J(e,"click",l[0]),z=!0)},p(a,[p]){if((!M||p&4)&&xt(c,a[2]),p&250){d=H(a[1]);let b;for(b=0;b<d.length;b+=1){const w=st(a,d,b);r[b]?(r[b].p(w,p),D(r[b],1)):(r[b]=ct(w),r[b].c(),D(r[b],1),r[b].m(y,null))}for(ht(),b=d.length;b<r.length;b+=1)T(b);dt()}},i(a){if(!M){for(let p=0;p<d.length;p+=1)D(r[p]);M=!0}},o(a){r=r.filter(Boolean);for(let p=0;p<r.length;p+=1)G(r[p]);M=!1},d(a){a&&(j(t),j(f),j(s),j(m),j(y)),at(r,a),z=!1,_()}}}function jt(l){switch(l.status){case"init":return" ";case"mark":return"F";case"clear":return l.value;default:return"X"}}function Mt(l,t,n){let i=30,c=16,f=99;const s=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];function e(h,u){let k=0;for(let C of s){const g=h+C[0],v=u+C[1];0<=g&&g<i&&0<=v&&v<c&&o[v][g].value==-1&&++k}return k}let o=[];for(let h=0;h<c;++h){o[h]=[];for(let u=0;u<i;++u)o[h][u]={x:u,y:h,status:"init",value:null,is_init:!1,freeze:!1}}let m=f;function y(h,u){n(2,--m)}function M(h,u){n(2,++m)}function z(h,u){let k=0;for(let C of s){const g=h+C[0],v=u+C[1];0<=g&&g<i&&0<=v&&v<c&&o[v][g].status=="mark"&&++k}return k}function _(h){const u=[[h.detail.x,h.detail.y]];for(;u.length>0;){const k=u.pop(),C=k[0],g=k[1];if(z(C,g)==o[g][C].value)for(let v of s){const x=C+v[0],O=g+v[1];0<=x&&x<i&&0<=O&&O<c&&o[O][x].status=="init"&&(o[O][x].value>=0?n(1,o[O][x].status="clear",o):(n(1,o[O][x].status="fail",o),T()),o[O][x].value==0&&u.push([x,O]))}}}function d(){n(2,m=f),a="working";for(const h of o)for(const u of h)u.status="init",u.value=null,u.is_init=!1,u.freeze=!1;n(1,o)}function r(h){const u=h.detail.x,k=h.detail.y;let C=0;for(;C<f;){const g=Math.floor(Math.random()*i),v=Math.floor(Math.random()*c);u-1<=g&&g<=u+1&&k-1<=v&&v<=k+1||o[v][g].value==null&&(n(1,o[v][g].value=-1,o),C++)}for(let g=0;g<c;++g)for(let v=0;v<i;++v)n(1,o[g][v].is_init=!0,o),o[g][v].value==null&&n(1,o[g][v].value=e(v,g),o);n(1,o[k][u].status="clear",o),_({detail:{x:u,y:k}})}function T(){a="failure";for(let h=0;h<c;++h)for(let u=0;u<i;++u)n(1,o[h][u].freeze=!0,o)}let a="working";function p(){return a!="working"||m>0||b()||(a="success"),a}function b(){for(const h of o)for(const u of h)if(u.status=="init")return!0;return!1}function w(){return{status:p(),count:f,remain:m,width:i,height:c,data:o.map(h=>h.map(jt))}}function E(h,u){o[u][h].status=="init"&&(n(2,--m),n(1,o[u][h].status="mark",o))}function S(h,u){o[u][h].status=="init"&&(o[u][h].value>=0?n(1,o[u][h].status="clear",o):(n(1,o[u][h].status="fail",o),T())),document.querySelector(`button#c-${h}-${u}`).click()}function U(){navigator.clipboard.writeText(JSON.stringify(o))}function R(h,u){l.$$.not_equal(u.status,h)&&(u.status=h,n(1,o))}return[d,o,m,y,M,_,r,T,w,E,S,U,R]}class zt extends W{constructor(t){super(),Y(this,t,Mt,Tt,L,{restart:0,view:8,mark:9,dig:10,do_copy:11})}get restart(){return this.$$.ctx[0]}get view(){return this.$$.ctx[8]}get mark(){return this.$$.ctx[9]}get dig(){return this.$$.ctx[10]}get do_copy(){return this.$$.ctx[11]}}function Ot(l){let t,n,i,c,f="Go",s,e,o="Step",m,y,M="Guess",z,_;return{c(){t=N("div"),n=N("p"),i=A(),c=N("button"),c.textContent=f,s=A(),e=N("button"),e.textContent=o,m=A(),y=N("button"),y.textContent=M},l(d){t=P(d,"DIV",{});var r=V(t);n=P(r,"P",{}),V(n).forEach(j),i=F(r),c=P(r,"BUTTON",{"data-svelte-h":!0}),X(c)!=="svelte-cs1isw"&&(c.textContent=f),s=F(r),e=P(r,"BUTTON",{"data-svelte-h":!0}),X(e)!=="svelte-15ylncw"&&(e.textContent=o),m=F(r),y=P(r,"BUTTON",{"data-svelte-h":!0}),X(y)!=="svelte-1m2zc6s"&&(y.textContent=M),r.forEach(j)},m(d,r){q(d,t,r),B(t,n),B(t,i),B(t,c),B(t,s),B(t,e),B(t,m),B(t,y),z||(_=[J(c,"click",l[1]),J(e,"click",l[0]),J(y,"click",l[3])],z=!0)},p:Q,i:Q,o:Q,d(d){d&&j(t),z=!1,ut(_)}}}function*Bt(l,t,n){for(const i of[-2,-1]){const c=n+i;if(!(c<0))for(const f of[-2,-1,0,1,2]){const s=t+f;0<=s&&s<l.width&&(yield{x:s,y:c})}}for(const i of[0]){const c=n+i;for(const f of[-2,-1]){const s=t+f;s>=0&&(yield{x:s,y:c})}}}function Nt(l){const t=[];for(let n=0;n<l.height;++n)for(let i=0;i<l.width;++i)l.data[n][i]===" "&&t.push({x:i,y:n});return{cells:t,min:l.remain,max:l.remain}}function K(l,t){return l.find(n=>n.x===t.x&&n.y===t.y)!=null}function Pt(l,t){return l.length==t.length&&l.every(n=>K(t,n))&&t.every(n=>K(l,n))}function rt(l){for(let t=l.length-2;t>=0;--t)for(let n=l.length-1;n>t;--n)Pt(l[t].cells,l[n].cells)&&(l[t].min=Math.max(l[t].min,l[n].min),l[t].max=Math.min(l[t].max,l[n].max),l[n]=l[l.length-1],l.length--)}function St(l){const t=[];for(const c of l){const f=(c.min+c.max)/c.cells.length;for(const s of c.cells){let e;s.y in t?e=t[s.y]:(e=[],t[s.y]=e),s.x in e?f>e[s.x]&&(e[s.x]=f):e[s.x]=f}}let n=4,i;for(const[c,f]of t.entries())if(f!=null)for(const[s,e]of f.entries())e!=null&&e<n&&(n=e,i={x:s,y:c});return i}function Ut(l,t,n){let{field:i}=t;const c=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];function*f(_,d,r){for(let T of c){const a=d+T[0],p=r+T[1];0<=a&&a<_.width&&0<=p&&p<_.height&&(yield{x:a,y:p})}}function s(_,d,r,T){let a=0;for(const p of f(_,d,r))T(_.data[p.y][p.x])&&++a;return a}function e(_,d,r,T){const a=[];for(const p of f(_,d,r))T(_.data[p.y][p.x])&&a.push(p);return a}function o(_){const d=i.view();if(d.status!="working")return!1;const r=m(d,_);if(!r||r.length==0)return!1;for(const T of r)switch(T.op){case"dig":i.dig(T.x,T.y);break;case"mark":i.mark(T.x,T.y)}return!0}function m(_,d){return y(_,d)}function y(_,d){const r=[Nt(_)];if(r[0].cells.length==_.height*_.width)return[{op:"dig",x:Math.floor(_.width/2),y:Math.floor(_.height/2)}];const T={};for(let w=0;w<_.height;++w)for(let E=0;E<_.width;++E)if(typeof _.data[w][E]=="number"){const S=_.data[w][E],U=e(_,E,w,k=>k===" ");if(U.length==0)continue;const R=s(_,E,w,k=>k==="F"),h=S-R,u={cells:U,min:h,max:h};r.push(u),T[`${E},${w}`]=[u]}for(let w=0;w<_.height;++w)for(let E=0;E<_.width;++E){const S=T[`${E},${w}`];if(S==null)continue;const U=S[0];for(const R of Bt(_,E,w)){const h=T[`${R.x},${R.y}`];if(h!=null)for(const u of[...h,r[0]]){const k={cells:[]},C={cells:[]},g={cells:[]};for(const x of U.cells)K(u.cells,x)?g.cells.push(x):k.cells.push(x);if(g.cells.length===0)continue;for(const x of u.cells)K(g.cells,x)||C.cells.push(x);if(C.cells.length==0&&k.cells.length==0)continue;for(const x of[k,C,g])x.min=0,x.max=x.cells.length;let v=!1;for(;!v;){let x=!1;for(const O of[U.max-k.min,u.max-C.min])O<g.max&&(g.max=O,x=!0);for(const O of[U.min-k.max,u.min-C.max])O>g.min&&(g.min=O,x=!0);U.max-g.min<k.max&&(k.max=U.max-g.min,x=!0),U.min-g.max>k.min&&(k.min=U.min-g.max,x=!0),u.max-g.min<C.max&&(C.max=u.max-g.min,x=!0),u.min-g.max>C.min&&(C.min=u.min-g.max,x=!0),v=!x}[g,k,C].filter(x=>x.cells.length>0).forEach(x=>r.push(x)),[g,k].filter(x=>x.cells.length>0).forEach(x=>S.push(x)),rt(S),u!==r[0]&&([g,C].filter(x=>x.cells.length>0).forEach(x=>h.push(x)),rt(h))}}}let a=r.filter(w=>w.cells.length==w.min),p=[];for(const w of a)for(const E of w.cells)p.push({op:"mark",x:E.x,y:E.y});a=r.filter(w=>w.max==0);for(const w of a)for(const E of w.cells)p.push({op:"dig",x:E.x,y:E.y});if(p.length>0)return p;if(!d)return[];const b=St(r);return b.op="dig",[b]}async function M(){setTimeout(()=>{o()&&M()},20)}const z=()=>o(!0);return l.$$set=_=>{"field"in _&&n(2,i=_.field)},[o,M,i,z]}class qt extends W{constructor(t){super(),Y(this,t,Ut,Ot,L,{field:2})}}function Dt(l){let t,n,i,c,f={};return t=new zt({props:f}),l[1](t),i=new qt({props:{field:l[0]}}),{c(){Z(t.$$.fragment),n=A(),Z(i.$$.fragment)},l(s){$(t.$$.fragment,s),n=F(s),$(i.$$.fragment,s)},m(s,e){tt(t,s,e),q(s,n,e),tt(i,s,e),c=!0},p(s,[e]){const o={};t.$set(o);const m={};e&1&&(m.field=s[0]),i.$set(m)},i(s){c||(D(t.$$.fragment,s),D(i.$$.fragment,s),c=!0)},o(s){G(t.$$.fragment,s),G(i.$$.fragment,s),c=!1},d(s){s&&j(n),l[1](null),et(t,s),et(i,s)}}}function It(l,t,n){let i;function c(f){mt[f?"unshift":"push"](()=>{i=f,n(0,i)})}return[i,c]}class Ft extends W{constructor(t){super(),Y(this,t,It,Dt,L,{})}}export{Ft as component};
